<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAILS Management System - Settings</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --dark-charcoal: #1a1a1a;
            --medium-grey: #2d2d2d;
            --light-grey: #404040;
            --background-grey: #f5f5f5;
            --pure-white: #ffffff;
            --professional-blue: #0066cc;
            --success-green: #28a745;
            --error-red: #dc3545;
            --warning-amber: #ffc107;
            --border-color: #e0e0e0;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --shadow: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-hover: 0 4px 8px rgba(0,0,0,0.15);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background-grey);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 14px;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--pure-white);
            border-right: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-header h1 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .sidebar-header p {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 400;
        }

        .sidebar-nav {
            padding: 16px 0;
        }

        .nav-group {
            margin-bottom: 24px;
        }

        .nav-group-title {
            padding: 8px 24px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .nav-item {
            display: block;
            padding: 12px 24px;
            text-decoration: none;
            color: var(--text-primary);
            font-weight: 500;
            transition: all 0.2s ease;
            border-left: 4px solid transparent;
            cursor: pointer;
        }

        .nav-item:hover {
            background: #f8f9fa;
            border-left-color: var(--professional-blue);
        }

        .nav-item.active {
            background: #e3f2fd;
            border-left-color: var(--professional-blue);
            color: var(--professional-blue);
        }

        .nav-item i {
            width: 20px;
            margin-right: 12px;
            font-size: 16px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 24px;
        }

        /* Header */
        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            background: var(--pure-white);
            padding: 20px 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .header-title h2 {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .header-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        /* Buttons */
        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: var(--pure-white);
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-1px);
        }

        .btn-primary {
            background: var(--professional-blue);
            color: white;
            border-color: var(--professional-blue);
        }

        .btn-success {
            background: var(--success-green);
            color: white;
            border-color: var(--success-green);
        }

        .btn-danger {
            background: var(--error-red);
            color: white;
            border-color: var(--error-red);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* Cards */
        .card {
            background: var(--pure-white);
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Tabs */
        .tabs-container {
            margin-bottom: 24px;
        }

        .tabs-nav {
            display: flex;
            background: var(--pure-white);
            border-radius: 12px;
            padding: 8px;
            box-shadow: var(--shadow);
            gap: 4px;
        }

        .tab-button {
            flex: 1;
            padding: 12px 16px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .tab-button.active {
            background: var(--professional-blue);
            color: white;
            box-shadow: var(--shadow);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            background: var(--pure-white);
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: #f8f9fa;
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            border-bottom: 2px solid var(--border-color);
        }

        .table td {
            padding: 16px 12px;
            border-bottom: 1px solid #f0f0f0;
            vertical-align: middle;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        /* Status Badges */
        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .badge-secondary {
            background: #e2e3e5;
            color: #383d41;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 5vh;
        }

        .modal-content {
            background: var(--pure-white);
            border-radius: 12px;
            padding: 24px;
            width: 100%;
            max-width: 600px;
            box-shadow: var(--shadow-hover);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0;
        }

        .modal-close:hover {
            color: var(--text-primary);
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--professional-blue);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--border-color);
        }

        /* User Avatar */
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--professional-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
            margin-right: 12px;
        }

        /* Settings Grid */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .setting-card {
            background: var(--pure-white);
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow);
            transition: all 0.2s ease;
        }

        .setting-card:hover {
            box-shadow: var(--shadow-hover);
        }

        .setting-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            margin-bottom: 16px;
        }

        .setting-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .setting-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        /* Permission Checkboxes */
        .permissions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin: 16px 0;
        }

        .permission-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .permission-item:hover {
            background: #f8f9fa;
        }

        .permission-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: var(--professional-blue);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 16px;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .tabs-nav {
                flex-direction: column;
                gap: 2px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>SAILS</h1>
                <p>Management System</p>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-group">
                    <div class="nav-group-title">Main</div>
                    <a href="index.html" class="nav-item">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </a>
                </div>
                
                <div class="nav-group">
                    <div class="nav-group-title">Project Management</div>
                    <a href="activities.html" class="nav-item">
                        <i class="fas fa-tasks"></i>
                        Activities
                    </a>
                    <a href="deliverables.html" class="nav-item">
                        <i class="fas fa-check-circle"></i>
                        Deliverables
                    </a>
                </div>
                
                <div class="nav-group">
                    <div class="nav-group-title">Procurement & Contracts</div>
                    <a href="procurements.html" class="nav-item">
                        <i class="fas fa-shopping-cart"></i>
                        Procurements
                    </a>
                    <a href="contracts.html" class="nav-item">
                        <i class="fas fa-file-contract"></i>
                        Contracts
                    </a>
                </div>
                
                <div class="nav-group">
                    <div class="nav-group-title">Resources</div>
                    <a href="assets.html" class="nav-item">
                        <i class="fas fa-cubes"></i>
                        Assets
                    </a>
                    <a href="finances.html" class="nav-item">
                        <i class="fas fa-dollar-sign"></i>
                        Finances
                    </a>
                </div>
                
                <div class="nav-group">
                    <div class="nav-group-title">Analytics</div>
                    <a href="reports.html" class="nav-item">
                        <i class="fas fa-chart-bar"></i>
                        Reports
                    </a>
                </div>
                
                <div class="nav-group">
                    <div class="nav-group-title">System</div>
                    <a class="nav-item active">
                        <i class="fas fa-cog"></i>
                        Settings
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <div class="main-header">
                <div class="header-title">
                    <h2>System Settings</h2>
                    <div class="header-subtitle">Manage users, roles, and system configuration</div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="backupSystem()">
                        <i class="fas fa-download"></i>
                        Backup System
                    </button>
                    <button class="btn" onclick="viewSystemLogs()">
                        <i class="fas fa-file-alt"></i>
                        System Logs
                    </button>
                </div>
            </div>

            <!-- Settings Overview -->
            <div class="settings-grid">
                <div class="setting-card">
                    <div class="setting-icon" style="background: var(--professional-blue);">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="setting-title">User Management</div>
                    <div class="setting-description">Manage user accounts, permissions, and access levels</div>
                    <button class="btn btn-primary" onclick="switchTab('users')">Manage Users</button>
                </div>

                <div class="setting-card">
                    <div class="setting-icon" style="background: var(--success-green);">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="setting-title">Role Management</div>
                    <div class="setting-description">Define roles and permissions for different user types</div>
                    <button class="btn btn-primary" onclick="switchTab('roles')">Manage Roles</button>
                </div>

                <div class="setting-card">
                    <div class="setting-icon" style="background: var(--warning-amber);">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <div class="setting-title">System Configuration</div>
                    <div class="setting-description">Configure system settings and preferences</div>
                    <button class="btn btn-primary" onclick="switchTab('system')">System Config</button>
                </div>

                <div class="setting-card">
                    <div class="setting-icon" style="background: var(--error-red);">
                        <i class="fas fa-database"></i>
                    </div>
                    <div class="setting-title">Data Management</div>
                    <div class="setting-description">Backup, restore, and manage system data</div>
                    <button class="btn btn-primary" onclick="switchTab('data')">Manage Data</button>
                </div>
            </div>

            <!-- Tabs Container -->
            <div class="tabs-container">
                <div class="tabs-nav">
                    <button class="tab-button active" onclick="switchTab('users')">
                        <i class="fas fa-users"></i>
                        User Management
                    </button>
                    <button class="tab-button" onclick="switchTab('roles')">
                        <i class="fas fa-shield-alt"></i>
                        Role Management
                    </button>
                    <button class="tab-button" onclick="switchTab('system')">
                        <i class="fas fa-cogs"></i>
                        System Config
                    </button>
                    <button class="tab-button" onclick="switchTab('data')">
                        <i class="fas fa-database"></i>
                        Data Management
                    </button>
                </div>

                <!-- Users Tab -->
                <div class="tab-content active" id="users-tab">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">User Accounts</h3>
                            <button class="btn btn-primary" onclick="openUserModal()">
                                <i class="fas fa-plus"></i>
                                Add User
                            </button>
                        </div>
                        
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>Last Login</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Roles Tab -->
                <div class="tab-content" id="roles-tab">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">System Roles</h3>
                            <button class="btn btn-primary" onclick="openRoleModal()">
                                <i class="fas fa-plus"></i>
                                Create Role
                            </button>
                        </div>
                        
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Role Name</th>
                                        <th>Description</th>
                                        <th>Users</th>
                                        <th>Permissions</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="rolesTableBody">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- System Config Tab -->
                <div class="tab-content" id="system-tab">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">System Configuration</h3>
                            <button class="btn btn-success" onclick="saveSystemConfig()">
                                <i class="fas fa-save"></i>
                                Save Configuration
                            </button>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">System Name</label>
                                <input type="text" class="form-control" id="systemName" value="SAILS Management System">
                            </div>
                            <div class="form-group">
                                <label class="form-label">System Version</label>
                                <input type="text" class="form-control" id="systemVersion" value="1.0.0" readonly>
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Default Currency</label>
                                <select class="form-control" id="defaultCurrency">
                                    <option value="USD">USD - US Dollar</option>
                                    <option value="MVR">MVR - Maldivian Rufiyaa</option>
                                    <option value="EUR">EUR - Euro</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Date Format</label>
                                <select class="form-control" id="dateFormat">
                                    <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                    <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                    <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Session Timeout (minutes)</label>
                                <input type="number" class="form-control" id="sessionTimeout" value="480" min="30" max="1440">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Auto-Backup Frequency</label>
                                <select class="form-control" id="backupFrequency">
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="disabled">Disabled</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="enableNotifications" checked style="margin-right: 8px;">
                                Enable Email Notifications
                            </label>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="enableAuditLog" checked style="margin-right: 8px;">
                                Enable Audit Logging
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Data Management Tab -->
                <div class="tab-content" id="data-tab">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                        <!-- Backup & Restore -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Backup & Restore</h3>
                            </div>
                            
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                <button class="btn btn-success" onclick="createBackup()">
                                    <i class="fas fa-download"></i>
                                    Create Full Backup
                                </button>
                                <button class="btn btn-primary" onclick="createDataExport()">
                                    <i class="fas fa-file-export"></i>
                                    Export Data
                                </button>
                                <button class="btn btn-warning" onclick="restoreFromBackup()">
                                    <i class="fas fa-upload"></i>
                                    Restore from Backup
                                </button>
                                <hr>
                                <h5>Recent Backups</h5>
                                <div style="font-size: 12px; color: var(--text-secondary);">
                                    • Full Backup - May 30, 2025 (12:00 AM)<br>
                                    • Data Export - May 29, 2025 (11:45 PM)<br>
                                    • Full Backup - May 29, 2025 (12:00 AM)
                                </div>
                            </div>
                        </div>

                        <!-- Data Maintenance -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Data Maintenance</h3>
                            </div>
                            
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                <button class="btn" onclick="optimizeDatabase()">
                                    <i class="fas fa-database"></i>
                                    Optimize Database
                                </button>
                                <button class="btn" onclick="cleanupTempFiles()">
                                    <i class="fas fa-broom"></i>
                                    Cleanup Temp Files
                                </button>
                                <button class="btn btn-danger" onclick="resetDemoData()">
                                    <i class="fas fa-refresh"></i>
                                    Reset Demo Data
                                </button>
                                <hr>
                                <h5>Database Statistics</h5>
                                <div style="font-size: 12px; color: var(--text-secondary);">
                                    • Total Records: 1,247<br>
                                    • Database Size: 45.2 MB<br>
                                    • Last Optimization: May 28, 2025
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- User Modal -->
    <div class="modal" id="userModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="userModalTitle">Add New User</h3>
                <button class="modal-close" onclick="closeUserModal()">&times;</button>
            </div>
            
            <form id="userForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">First Name</label>
                        <input type="text" class="form-control" id="firstName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Last Name</label>
                        <input type="text" class="form-control" id="lastName" required>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-control" id="username" required>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Role</label>
                        <select class="form-control" id="userRole" required>
                            <option value="">Select Role</option>
                            <option value="admin">Administrator</option>
                            <option value="project_director">Project Director</option>
                            <option value="procurement_officer">Procurement Officer</option>
                            <option value="finance_officer">Finance Officer</option>
                            <option value="component_manager">Component Manager</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-control" id="userStatus">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="suspended">Suspended</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Temporary Password</label>
                    <input type="password" class="form-control" id="tempPassword" placeholder="Will be auto-generated if left blank">
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn" onclick="closeUserModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create User</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Role Modal -->
    <div class="modal" id="roleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="roleModalTitle">Create New Role</h3>
                <button class="modal-close" onclick="closeRoleModal()">&times;</button>
            </div>
            
            <form id="roleForm">
                <div class="form-group">
                    <label class="form-label">Role Name</label>
                    <input type="text" class="form-control" id="roleName" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-control" id="roleDescription" rows="2"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Permissions</label>
                    <div class="permissions-grid" id="permissionsGrid">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn" onclick="closeRoleModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Role</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Application State
        let users = [];
        let roles = [];
        let currentTab = 'users';
        let editingUser = null;
        let editingRole = null;

        // In-Memory Storage
        const inMemoryStorage = {};

        // Sample Data
        const sampleUsers = [
            {
                id: 'user_001',
                firstName: 'Jailam',
                lastName: 'Mohe',
                email: 'jailam.mohe@sails.gov.mv',
                username: 'admin',
                role: 'admin',
                status: 'active',
                lastLogin: '2025-05-30T08:30:00Z',
                createdAt: '2025-01-01',
                avatar: 'JM'
            },
            {
                id: 'user_002',
                firstName: 'Sarah',
                lastName: 'Johnson',
                email: 'sarah.johnson@sails.gov.mv',
                username: 'procurement',
                role: 'procurement_officer',
                status: 'active',
                lastLogin: '2025-05-29T16:45:00Z',
                createdAt: '2025-01-15',
                avatar: 'SJ'
            },
            {
                id: 'user_003',
                firstName: 'Ahmed',
                lastName: 'Hassan',
                email: 'ahmed.hassan@sails.gov.mv',
                username: 'finance',
                role: 'finance_officer',
                status: 'active',
                lastLogin: '2025-05-30T09:15:00Z',
                createdAt: '2025-02-01',
                avatar: 'AH'
            }
        ];

        const sampleRoles = [
            {
                id: 'role_001',
                name: 'Administrator',
                description: 'Full system access and administration privileges',
                permissions: ['all'],
                userCount: 1
            },
            {
                id: 'role_002',
                name: 'Project Director',
                description: 'Project oversight and management responsibilities',
                permissions: ['dashboard', 'activities', 'deliverables', 'reports', 'finances_view'],
                userCount: 1
            },
            {
                id: 'role_003',
                name: 'Procurement Officer',
                description: 'Procurement and contract management',
                permissions: ['procurements', 'contracts', 'assets', 'vendors'],
                userCount: 1
            },
            {
                id: 'role_004',
                name: 'Finance Officer',
                description: 'Financial management and reporting',
                permissions: ['finances', 'contracts_view', 'reports', 'budget_management'],
                userCount: 1
            }
        ];

        const availablePermissions = [
            'dashboard', 'activities', 'deliverables', 'procurements', 'contracts', 
            'assets', 'finances', 'reports', 'user_management', 'system_config'
        ];

        // Initialize Application
        function initializeApp() {
            users = inMemoryStorage['sails_users'] ? 
                JSON.parse(inMemoryStorage['sails_users']) : [...sampleUsers];
            roles = inMemoryStorage['sails_roles'] ? 
                JSON.parse(inMemoryStorage['sails_roles']) : [...sampleRoles];

            renderCurrentTab();
            setupEventListeners();
            
            setTimeout(() => {
                showNotification('Settings module loaded successfully', 'success');
            }, 500);
        }

        // Tab Management
        function switchTab(tabName) {
            currentTab = tabName;
            
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            renderCurrentTab();
        }

        function renderCurrentTab() {
            switch (currentTab) {
                case 'users':
                    renderUsers();
                    break;
                case 'roles':
                    renderRoles();
                    break;
                case 'system':
                    renderSystemConfig();
                    break;
                case 'data':
                    renderDataManagement();
                    break;
            }
        }

        // Render Functions
        function renderUsers() {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center;">
                            <div class="user-avatar">${user.avatar}</div>
                            <div>
                                <div style="font-weight: 500;">${user.firstName} ${user.lastName}</div>
                                <div style="font-size: 12px; color: var(--text-secondary);">@${user.username}</div>
                            </div>
                        </div>
                    </td>
                    <td>${user.email}</td>
                    <td><span class="badge badge-info">${formatRole(user.role)}</span></td>
                    <td><span class="badge badge-${getUserStatusClass(user.status)}">${formatStatus(user.status)}</span></td>
                    <td>${formatDateTime(user.lastLogin)}</td>
                    <td>
                        <button class="btn btn-sm" onclick="editUser('${user.id}')" title="Edit User">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteUser('${user.id}')" title="Delete User">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderRoles() {
            const tbody = document.getElementById('rolesTableBody');
            tbody.innerHTML = '';
            
            roles.forEach(role => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${role.name}</strong></td>
                    <td>${role.description}</td>
                    <td><span class="badge badge-secondary">${role.userCount} users</span></td>
                    <td>
                        <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                            ${role.permissions.slice(0, 3).map(p => `<span class="badge badge-info">${p}</span>`).join('')}
                            ${role.permissions.length > 3 ? `<span class="badge badge-secondary">+${role.permissions.length - 3}</span>` : ''}
                        </div>
                    </td>
                    <td>
                        <button class="btn btn-sm" onclick="editRole('${role.id}')" title="Edit Role">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteRole('${role.id}')" title="Delete Role">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderSystemConfig() {
            // System config is mostly static form, no dynamic rendering needed
        }

        function renderDataManagement() {
            // Data management is mostly static, no dynamic rendering needed
        }

        // Modal Functions
        function openUserModal(userId = null) {
            editingUser = userId;
            const modal = document.getElementById('userModal');
            const form = document.getElementById('userForm');
            
            if (userId) {
                const user = users.find(u => u.id === userId);
                if (user) {
                    document.getElementById('userModalTitle').textContent = 'Edit User';
                    populateUserForm(user);
                }
            } else {
                document.getElementById('userModalTitle').textContent = 'Add New User';
                form.reset();
            }
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeUserModal() {
            const modal = document.getElementById('userModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
            editingUser = null;
        }

        function openRoleModal(roleId = null) {
            editingRole = roleId;
            const modal = document.getElementById('roleModal');
            const form = document.getElementById('roleForm');
            
            renderPermissionsGrid();
            
            if (roleId) {
                const role = roles.find(r => r.id === roleId);
                if (role) {
                    document.getElementById('roleModalTitle').textContent = 'Edit Role';
                    populateRoleForm(role);
                }
            } else {
                document.getElementById('roleModalTitle').textContent = 'Create New Role';
                form.reset();
            }
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeRoleModal() {
            const modal = document.getElementById('roleModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
            editingRole = null;
        }

        function renderPermissionsGrid() {
            const container = document.getElementById('permissionsGrid');
            container.innerHTML = '';
            
            availablePermissions.forEach(permission => {
                const item = document.createElement('div');
                item.className = 'permission-item';
                item.innerHTML = `
                    <input type="checkbox" id="perm_${permission}" value="${permission}">
                    <label for="perm_${permission}">${formatPermission(permission)}</label>
                `;
                container.appendChild(item);
            });
        }

        function populateUserForm(user) {
            document.getElementById('firstName').value = user.firstName;
            document.getElementById('lastName').value = user.lastName;
            document.getElementById('email').value = user.email;
            document.getElementById('username').value = user.username;
            document.getElementById('userRole').value = user.role;
            document.getElementById('userStatus').value = user.status;
        }

        function populateRoleForm(role) {
            document.getElementById('roleName').value = role.name;
            document.getElementById('roleDescription').value = role.description;
            
            // Check appropriate permissions
            role.permissions.forEach(permission => {
                const checkbox = document.getElementById(`perm_${permission}`);
                if (checkbox) {
                    checkbox.checked = true;
                }
            });
        }

        // CRUD Operations
        function editUser(userId) {
            openUserModal(userId);
        }

        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                users = users.filter(u => u.id !== userId);
                saveUsers();
                renderUsers();
                showNotification('User deleted successfully', 'success');
            }
        }

        function editRole(roleId) {
            openRoleModal(roleId);
        }

        function deleteRole(roleId) {
            if (confirm('Are you sure you want to delete this role?')) {
                roles = roles.filter(r => r.id !== roleId);
                saveRoles();
                renderRoles();
                showNotification('Role deleted successfully', 'success');
            }
        }

        function saveUsers() {
            inMemoryStorage['sails_users'] = JSON.stringify(users);
        }

        function saveRoles() {
            inMemoryStorage['sails_roles'] = JSON.stringify(roles);
        }

        // Event Listeners
        function setupEventListeners() {
            // User form
            document.getElementById('userForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = {
                    firstName: document.getElementById('firstName').value,
                    lastName: document.getElementById('lastName').value,
                    email: document.getElementById('email').value,
                    username: document.getElementById('username').value,
                    role: document.getElementById('userRole').value,
                    status: document.getElementById('userStatus').value
                };
                
                if (editingUser) {
                    const index = users.findIndex(u => u.id === editingUser);
                    if (index !== -1) {
                        users[index] = { ...users[index], ...formData };
                        showNotification('User updated successfully', 'success');
                    }
                } else {
                    const newUser = {
                        id: 'user_' + Date.now(),
                        ...formData,
                        avatar: (formData.firstName.charAt(0) + formData.lastName.charAt(0)).toUpperCase(),
                        lastLogin: null,
                        createdAt: new Date().toISOString().split('T')[0]
                    };
                    users.push(newUser);
                    showNotification('User created successfully', 'success');
                }
                
                saveUsers();
                renderUsers();
                closeUserModal();
            });

            // Role form
            document.getElementById('roleForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const selectedPermissions = Array.from(document.querySelectorAll('#permissionsGrid input:checked'))
                    .map(checkbox => checkbox.value);
                
                const formData = {
                    name: document.getElementById('roleName').value,
                    description: document.getElementById('roleDescription').value,
                    permissions: selectedPermissions
                };
                
                if (editingRole) {
                    const index = roles.findIndex(r => r.id === editingRole);
                    if (index !== -1) {
                        roles[index] = { ...roles[index], ...formData };
                        showNotification('Role updated successfully', 'success');
                    }
                } else {
                    const newRole = {
                        id: 'role_' + Date.now(),
                        ...formData,
                        userCount: 0
                    };
                    roles.push(newRole);
                    showNotification('Role created successfully', 'success');
                }
                
                saveRoles();
                renderRoles();
                closeRoleModal();
            });
        }

        // System Functions
        function saveSystemConfig() {
            showNotification('System configuration saved successfully', 'success');
        }

        function backupSystem() {
            showNotification('Creating system backup...', 'info');
            setTimeout(() => {
                showNotification('System backup created successfully', 'success');
            }, 2000);
        }

        function viewSystemLogs() {
            showNotification('System logs viewer would open here', 'info');
        }

        function createBackup() {
            showNotification('Creating full backup...', 'info');
            setTimeout(() => {
                showNotification('Full backup created successfully', 'success');
            }, 3000);
        }

        function createDataExport() {
            showNotification('Exporting data...', 'info');
            setTimeout(() => {
                showNotification('Data export completed', 'success');
            }, 2000);
        }

        function restoreFromBackup() {
            if (confirm('Are you sure you want to restore from backup? This will overwrite current data.')) {
                showNotification('Restoring from backup...', 'info');
                setTimeout(() => {
                    showNotification('System restored successfully', 'success');
                }, 4000);
            }
        }

        function optimizeDatabase() {
            showNotification('Optimizing database...', 'info');
            setTimeout(() => {
                showNotification('Database optimization completed', 'success');
            }, 2000);
        }

        function cleanupTempFiles() {
            showNotification('Cleaning up temporary files...', 'info');
            setTimeout(() => {
                showNotification('Temporary files cleaned up', 'success');
            }, 1500);
        }

        function resetDemoData() {
            if (confirm('Are you sure you want to reset all demo data? This action cannot be undone.')) {
                showNotification('Resetting demo data...', 'warning');
                setTimeout(() => {
                    // Reset to original sample data
                    users = [...sampleUsers];
                    roles = [...sampleRoles];
                    saveUsers();
                    saveRoles();
                    renderCurrentTab();
                    showNotification('Demo data reset successfully', 'success');
                }, 2000);
            }
        }

        // Navigation
        function navigateTo(module) {
    // Instead of showing notification, actually navigate
    const moduleUrls = {
        'dashboard': 'index.html',
        'activities': 'activities.html',
        'procurements': 'procurements.html',
        'contracts': 'contracts.html',
        'finances': 'finances.html',
        'deliverables': 'deliverables.html',
        'assets': 'assets.html',
        'settings': 'settings.html',
        'reports': 'reports.html'
    };
    
    if (moduleUrls[module]) {
        window.location.href = moduleUrls[module];
    }
}

        // Utility Functions
        function formatRole(role) {
            const roleMap = {
                'admin': 'Administrator',
                'project_director': 'Project Director',
                'procurement_officer': 'Procurement Officer',
                'finance_officer': 'Finance Officer',
                'component_manager': 'Component Manager'
            };
            return roleMap[role] || role;
        }

        function formatStatus(status) {
            return status.charAt(0).toUpperCase() + status.slice(1);
        }

        function formatPermission(permission) {
            return permission.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        function getUserStatusClass(status) {
            const statusMap = {
                'active': 'success',
                'inactive': 'secondary',
                'suspended': 'danger'
            };
            return statusMap[status] || 'secondary';
        }

        function formatDateTime(dateString) {
            if (!dateString) return 'Never';
            return new Date(dateString).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Notification System
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? 'var(--success-green)' : 
                            type === 'error' ? 'var(--error-red)' : 
                            type === 'warning' ? 'var(--warning-amber)' : 'var(--professional-blue)'};
                color: white;
                padding: 16px 20px;
                border-radius: 8px;
                box-shadow: var(--shadow-hover);
                z-index: 10000;
                font-weight: 500;
                max-width: 300px;
                animation: slideInRight 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Initialize the application
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
